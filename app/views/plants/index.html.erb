<!-- Banner -->

<div class="banner" style="background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url(<%= image_path('banner_placeholder.svg') %>);">
  <div class="dropdown align-self-end">
    <!-- avatar -->
    <% if current_user.photo.attached? %>
      <%= cl_image_tag current_user.photo.key, width: 56, height: 56, crop: :fill, class: "avatar-large align-self-start dropdown-toggle", id: "navbarDropdown", data: { toggle: "dropdown" }, 'aria-haspopup': true, 'aria-expanded': false %>
    <% else %>
      <%= image_tag "avatar_placeholder.svg", alt: "avatar", class: "avatar-large align-self-start dropdown-toggle", id: "navbarDropdown", data: { toggle: "dropdown" }, 'aria-haspopup': true, 'aria-expanded': false %>
    <% end %>
    <!-- dropdown-menu from avatar -->
    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
      <%= link_to "Action", "#", class: "dropdown-item" %>
      <%= link_to "Another action", "#", class: "dropdown-item" %>
      <%= link_to "Log out", destroy_user_session_path, method: :delete, class: "dropdown-item" %>
    </div>
  </div>
</div>


<!-- Tabs -->

<nav class="nav claire-garden-tabs d-flex justify-content-around flex-nowrap">
  <a class="active py-2" href="#tab-my-plants" data-toggle="tab">Mes plantes</a>
  <a class="py-2" href="#tab-my-calendar" data-toggle="tab">Mon calendrier</a>
</nav>

<!-- Tabs-content -->

<div class="tab-content mt-2">

  <!-- my-plants-Tab -->

  <div class="tab-pane active" id="tab-my-plants">
    <div class="container">
      <div class="row">
        <!-- dropdown filter -->
        <div class="col-6 px-2">
          <%= form_tag plants_path, method: :get, class: "column-filter dropdown-filter", id: "plant-tab-filter-form" do %>
            <%= label_tag "Type de plante" %>
            <%= select_tag "plant_type", options_for_select( Plant::CATEGORIES, @selected_category ) %>
            <%= submit_tag "Apply filters", class: 'btn btn-primary d-none', id: "filter-form-button", name: nil %>
          <% end %>
        </div>
        <!-- search bar -->
        <div class="col-6 px-2">
          <%= form_tag plants_path, method: :get do %>
            <%= label_tag "Recherche" %>
            <%= text_field_tag :query,
              params[:query],
              class: "form-control",
              placeholder: "trouver une plante"
            %>
          <% end %>
        </div>
      </div>
    </div>

    <!-- plant cards -->
    <div class="container">
      <div class="row">
        <% @plants.each do |plant| %>
          <%= link_to plant_path(plant), class: 'text-decoration-none col-6 px-2' do %>
            <div class="card plant-card"
              style="background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)),
              <% if plant.photo.attached? %>
                url(<%= cl_image_path plant.photo.key, height: 500, crop: :fill %>);
              <% else %>
                url(<%= image_path('flower_placeholder.jpg') %>);
              <% end %>">
              <h4><%= plant.name %></h4>
            </div>
          <% end %>
        <% end %>
      </div>
    </div>

    <!-- Add a new plant button -->
    <button class="btn btn-primary claire-garden-button button-sticky-bottom" data-toggle="modal" data-target="#newPlantModal">AJOUTER UNE PLANTE</button>

  </div>

  <!-- my-calendar-Tab -->

  <div class="tab-pane" id="tab-my-calendar">
    <div class="container">
      <!-- dropdown filter -->
      <%= form_tag plants_path, method: :get, class: "inline-filter dropdown-filter row px-2 mb-3", id: "calendar-tab-filter-form" do %>
        <div class="col-6 d-flex justify-content-center align-items-center p-0">
          <%= label_tag "Type de plante" %>
        </div>
        <div class="col-6 p-0">
          <%= select_tag "plant_type2", options_for_select( Plant::CATEGORIES, @selected_category ) %>
        </div>
        <%= submit_tag "Apply filters", class: 'btn btn-primary d-none', id: "filter-form-button" %>
      <% end %>

      <!-- calendar -->
      <div class="row text-center">
        <%= form_tag plants_path, method: :get, class: "month-filter_search", id: "month-filter-form" do %>
          <% ["janvier", "FÃ©vrier", "Mars", "Avril", "Mai", "Juin", "Juillet", "AoÃ»t", "Septembre", "Octobre", "Novembre", "DÃ©cembre"].each do |month| %>
            <%= check_box_tag "month[#{month}]", month, params[:month]&.include?(month) %>
            <%= label_tag "month[#{month}]", month, style: '', class: "col-3 text-center p-0" %>
          <% end %>
          <%= submit_tag "Apply filters", class: 'btn btn-primary d-none', id: "filter-form-button" %>
        <% end %>
      </div>

      <!-- Tasks -->
      <h5 class="my-3">Actions</h5>
      <!-- tasks cards -->
      <% @tasks.each do |task| %>
        <%= link_to task_path(task), class: 'text-decoration-none' do %>
          <div class="card task-card">
            <% if task.photo.attached? %>
              <%= cl_image_tag task.photo.key, height: 100, crop: :fill %>
            <% else %>
              <%= image_tag('task_placeholder.jpg') %>
            <% end %>
            <section>
              <div class="d-flex justify-content-between">
                <span class="plant-name-in-task-card"><%= task.plant.name %></span>
                <div class="d-flex justify-content-end mb-2">
                  <span class="badge badge-pill badge-success mx-2"><%= task.season %></span>
                  <span class="badge badge-pill badge-warning mx-2"><%= task.periodicity %></span>
                </div>
              </div>
              <h6><%= task.name %></h6>
            </section>
          </div>
        <% end %>
      <% end %>
    </div>
  </div>
</div>


<!-- new plant modal -->

<div class="modal fade" id="newPlantModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Nouvelle plante</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="container">
          <%= simple_form_for [@plant] do |f| %>
            <%= f.input :name,
                        label: false,
                        placeholder: "Nom*",
                        input_html: { class: "col-12 mb-3" } %>

            <%= f.input :notes,
                        label: false,
                        placeholder: "Notes",
                        input_html: { class: "col-12 mb-3" } %>

            <%= f.input :category,
                        placeholder: "Type de plante",
                        as: :select,
                        collection: Plant::CATEGORIES,
                        input_html: { class: "col-12" } %>

            <%= f.input :photo,
                          as: :file,
                          input_html: { class: "d-none", id: 'photo-input' },
                          label_html: { class: 'upload-photo col-12 text-center'},
                          label: 'ðŸ“· Choisissez une photo' %>
            <%#= image_tag "", width: 300, class: "hidden mx-auto mb-2", id: "photo-preview" %>
            <div class="row">
              <%= link_to 'Annuler', plants_path, class: "btn btn-outline-danger col-6" %>
              <%= f.submit 'Valider', class: "btn btn-primary col-6 disabled", id: 'new-plant-submit' %>
            </div>
          <% end %>

        </div>
      </div>
    </div>
  </div>
</div>
